{% extends "base.html" %}

{% block content %}
<div class="container py-5">

    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold mb-1" style="color: #D4A5A5;">ğŸ“ˆ æµè¡Œè¶¨å‹¢æƒ…å ±</h2>
            <p class="text-muted mb-0">AI é æ¸¬ä¸‹å€‹æœˆçš„æ™‚å°šé¢¨å‘ (æ¯æ—¥æ›´æ–°)</p>
        </div>
        <div class="badge bg-light text-dark border px-3 py-2 rounded-pill">
            <i class="fas fa-map-marker-alt me-1 text-danger"></i> {{ region }}
        </div>
    </div>

    <div class="row g-4">
        {% for t in trends %}
        <div class="col-md-6 col-lg-4">
            <div class="glass-card h-100 p-4 hover-lift">

                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <span class="badge bg-secondary mb-2">{{ t.category }}</span>
                        <h4 class="fw-bold mb-0">{{ t.keyword }}</h4>
                    </div>
                    <div class="text-center">
                        <h3 class="fw-bold text-primary mb-0">{{ t.score }}</h3>
                        <small class="text-muted" style="font-size: 0.7em;">ç†±åº¦æŒ‡æ•¸</small>
                    </div>
                </div>

                <p class="text-muted mb-4">{{ t.description }}</p>

                <div class="bg-white bg-opacity-50 rounded p-3 mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <small class="text-muted">å€‹äººé©é…åº¦</small>
                        <span class="fw-bold {{ 'text-success' if t.match_score > 80 else 'text-warning' }}">
                            {{ t.match_score }}%
                        </span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar {{ 'bg-success' if t.match_score > 80 else 'bg-warning' }}"
                             role="progressbar"
                             style="width: {{ t.match_score }}%"></div>
                    </div>

                    <div class="mt-3 pt-2 border-top">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">ä¸‹æœˆé æ¸¬</small>
                            {% if t.prediction > t.score %}
                                <small class="text-danger fw-bold"><i class="fas fa-arrow-up"></i> ä¸Šå‡è¶¨å‹¢</small>
                            {% else %}
                                <small class="text-secondary"><i class="fas fa-minus"></i> æŒå¹³</small>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <h6 class="fw-bold text-muted mb-3" style="font-size: 0.85rem;">
                    <i class="fas fa-star me-1 text-warning"></i> åäººç¤ºç¯„
                </h6>

                <div class="list-group list-group-flush rounded-3">
                    {% for c in t.celebs %}
                    <div class="list-group-item bg-transparent d-flex align-items-center px-0 py-2 border-bottom-0">
                        <div class="avatar-circle me-3 bg-light text-secondary d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border-radius: 50%;">
                            <i class="fas fa-user"></i>
                        </div>

                        <div class="flex-grow-1">
                            <h6 class="mb-0 fw-bold" style="font-size: 0.9rem;">{{ c.celeb_name }}</h6>
                            <small class="text-muted text-truncate d-block" style="font-size: 0.75rem; max-width: 150px;">
                                {{ c.description }}
                            </small>
                        </div>

                        <div class="text-end">
                            <small class="text-danger fw-bold d-block">
                                <i class="fas fa-heart"></i> {{ (c.likes_count / 10000)|int }}w
                            </small>
                            <button class="btn btn-sm btn-link text-decoration-none p-0"
                                    style="font-size: 0.75rem;"
                                    onclick="matchStyle('{{ c.celeb_name }}')">
                                è©¦ç©¿
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>

            </div>
        </div>
        {% endfor %}
    </div>

    <div class="text-center mt-5 text-muted">
        <small>æ•¸æ“šæ¯æ—¥ 00:00 è‡ªå‹•æ›´æ–° | è³‡æ–™ä¾†æºï¼šå…¨çƒæ™‚å°šç¤¾ç¾¤èˆ‡æœå°‹å¼•æ“</small>
    </div>
</div>

<script>
function matchStyle(celebName) {
    // å‘¼å«å¾Œç«¯ API é€²è¡Œæ¯”å° (é€™è£¡åƒ…åš UI æ¨¡æ“¬)
    fetch('/api/trend/match_celeb', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ celeb: celebName })
    })
    .then(r => r.json())
    .then(data => {
        alert(`âœ¨ é¢¨æ ¼æ¯”å°å®Œæˆï¼\n\næ‚¨èˆ‡ ${celebName} çš„ç›¸ä¼¼åº¦ç‚º ${data.similarity}%\nè©•èªï¼š${data.msg}`);
    });
}
</script>

<style>
    /* ç»ç’ƒæ“¬æ…‹å¡ç‰‡ */
    .glass-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* æ‡¸åœä¸Šæµ®æ•ˆæœ */
    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(31, 38, 135, 0.15);
    }

    /* é€²åº¦æ¢æ¨£å¼ */
    .progress {
        background-color: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
    }
</style>
{% endblock %}